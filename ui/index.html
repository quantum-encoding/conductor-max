<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ”± Conductor Max - AI Orchestration Platform</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            background: #000;
            color: #00ff00;
            font-family: 'Fira Code', monospace;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f0f1e 100%);
            border-bottom: 2px solid #00ff00;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 32px;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            padding: 40px;
            overflow-y: auto;
        }
        
        .control-panel {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .agent-card {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .agent-card:hover {
            background: rgba(0, 255, 0, 0.1);
            transform: translateY(-2px);
        }
        
        .agent-card.claude {
            border-color: #ff9900;
            background: rgba(255, 153, 0, 0.05);
        }
        
        .agent-card.gemini {
            border-color: #00aaff;
            background: rgba(0, 170, 255, 0.05);
        }
        
        .agent-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .agent-status {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff00;
        }
        
        .agent-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .spawn-panel {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .spawn-card {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .spawn-card:hover {
            background: rgba(0, 255, 0, 0.2);
            transform: scale(1.05);
        }
        
        .spawn-card.claude {
            border-color: #ff9900;
            background: rgba(255, 153, 0, 0.1);
        }
        
        .spawn-card.gemini {
            border-color: #00aaff;
            background: rgba(0, 170, 255, 0.1);
        }
        
        .spawn-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .metric-card {
            background: rgba(0, 255, 0, 0.05);
            border: 1px solid rgba(0, 255, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            color: #00ff00;
        }
        
        .metric-label {
            font-size: 12px;
            opacity: 0.7;
            margin-top: 5px;
        }
        
        .v-hierarchy {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid #00ff00;
            border-radius: 10px;
            font-size: 12px;
            max-width: 300px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">
            <span class="logo-icon">ðŸ”±</span>
            <div>
                <div class="logo-text">CONDUCTOR MAX</div>
                <div style="font-size: 12px; opacity: 0.7;">Quantum Encoding Ltd</div>
            </div>
        </div>
        <div class="header-controls">
            <button class="btn" onclick="openStrategyWindow()">ðŸŽ¯ Strategy AI</button>
            <button class="btn" onclick="exportSession()">ðŸ’¾ Export Session</button>
        </div>
    </div>
    
    <div class="main-content">
        <div class="control-panel">
            <!-- Spawn Section -->
            <div class="section">
                <div class="section-header">
                    <h2>ðŸš€ Spawn New Agents</h2>
                    <span style="opacity: 0.7;">Click to spawn with native authentication</span>
                </div>
                <div class="spawn-panel">
                    <div class="spawn-card claude" onclick="spawnAgent('claude')">
                        <div class="spawn-icon">ðŸ¤–</div>
                        <h3>Claude Agent</h3>
                        <p>V1-V3 Execution Engine</p>
                        <p style="font-size: 12px; opacity: 0.7;">
                            Uses browser auth or API key<br>
                            from ~/.config/claude
                        </p>
                    </div>
                    <div class="spawn-card gemini" onclick="spawnAgent('gemini')">
                        <div class="spawn-icon">ðŸ¤–</div>
                        <h3>Gemini Agent</h3>
                        <p>V1-V3 Execution Engine</p>
                        <p style="font-size: 12px; opacity: 0.7;">
                            Uses Google account<br>
                            or API key authentication
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Active Agents Section -->
            <div class="section">
                <div class="section-header">
                    <h2>âš¡ Active Agents</h2>
                    <button class="btn" onclick="killAllAgents()">ðŸ›‘ Stop All</button>
                </div>
                <div id="agent-grid" class="agent-grid">
                    <!-- Agent cards will be inserted here -->
                </div>
                <div id="no-agents" style="text-align: center; padding: 40px; opacity: 0.5;">
                    No active agents. Spawn an agent to begin orchestration.
                </div>
            </div>
            
            <!-- Metrics Section -->
            <div class="section">
                <div class="section-header">
                    <h2>ðŸ“Š Session Metrics</h2>
                </div>
                <div class="metrics">
                    <div class="metric-card">
                        <div class="metric-value" id="agent-count">0</div>
                        <div class="metric-label">Active Agents</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="total-commands">0</div>
                        <div class="metric-label">Commands Sent</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="session-duration">00:00:00</div>
                        <div class="metric-label">Session Duration</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="v-hierarchy">
        <strong>V-Omega Hierarchy</strong><br>
        V1-V3: Agent Execution<br>
        V4-V6: Strategic Orchestration<br>
        V7-V10: Philosophical Governance<br>
        <br>
        <em>"Multiple minds, unified purpose"</em><br>
        ðŸ¦† The ducks observe
    </div>
    
    <script src="conductor-max.js"></script>
    <script>
        const { invoke } = window.__TAURI__.core;
        
        let agents = new Map();
        let sessionStartTime = Date.now();
        let totalCommands = 0;
        
        // Open Strategy AI window
        async function openStrategyWindow() {
            try {
                await invoke('open_strategy_window');
            } catch (error) {
                console.error('Failed to open strategy window:', error);
            }
        }
        
        // Spawn new agent
        async function spawnAgent(type) {
            try {
                console.log(`Spawning ${type} agent...`);
                
                // Get workspace path (optional)
                const workspace = prompt(`Enter workspace path for ${type} agent (or leave empty):`);
                
                const agentId = await invoke('spawn_agent', {
                    agent_type: type,
                    api_key: '', // Not needed - native auth
                    agent_id: null,
                    workspace_path: workspace || null
                });
                
                console.log(`Agent spawned: ${agentId}`);
                
                // Store agent info
                agents.set(agentId, {
                    id: agentId,
                    type: type,
                    startTime: Date.now(),
                    status: 'running'
                });
                
                // Open agent window
                await invoke('open_agent_window', {
                    agent_id: agentId,
                    agent_type: type
                });
                
                // Update UI
                updateAgentGrid();
                updateMetrics();
                
            } catch (error) {
                console.error(`Failed to spawn ${type} agent:`, error);
                alert(`Failed to spawn ${type} agent: ${error}`);
            }
        }
        
        // Update agent grid
        function updateAgentGrid() {
            const grid = document.getElementById('agent-grid');
            const noAgents = document.getElementById('no-agents');
            
            if (agents.size === 0) {
                grid.innerHTML = '';
                noAgents.style.display = 'block';
                return;
            }
            
            noAgents.style.display = 'none';
            grid.innerHTML = '';
            
            agents.forEach(agent => {
                const card = document.createElement('div');
                card.className = `agent-card ${agent.type}`;
                card.innerHTML = `
                    <div class="agent-card-header">
                        <div>
                            <strong>${agent.type.toUpperCase()}</strong>
                            <div style="font-size: 12px; opacity: 0.7;">${agent.id.slice(0, 8)}</div>
                        </div>
                        <div class="agent-status">
                            <div class="status-dot"></div>
                            <span>Running</span>
                        </div>
                    </div>
                    <div style="font-size: 12px; opacity: 0.7;">
                        Started: ${new Date(agent.startTime).toLocaleTimeString()}
                    </div>
                    <div class="agent-controls">
                        <button class="btn" onclick="focusAgentWindow('${agent.id}', '${agent.type}')">
                            Open Terminal
                        </button>
                        <button class="btn" onclick="killAgent('${agent.id}')">
                            Stop
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Focus agent window
        async function focusAgentWindow(agentId, agentType) {
            try {
                await invoke('open_agent_window', {
                    agent_id: agentId,
                    agent_type: agentType
                });
            } catch (error) {
                console.error('Failed to focus agent window:', error);
            }
        }
        
        // Kill specific agent
        async function killAgent(agentId) {
            if (!confirm(`Stop agent ${agentId.slice(0, 8)}?`)) return;
            
            try {
                await invoke('kill_agent', { agent_id: agentId });
                agents.delete(agentId);
                updateAgentGrid();
                updateMetrics();
            } catch (error) {
                console.error('Failed to kill agent:', error);
            }
        }
        
        // Kill all agents
        async function killAllAgents() {
            if (!confirm('Stop all agents?')) return;
            
            for (const [agentId] of agents) {
                try {
                    await invoke('kill_agent', { agent_id: agentId });
                } catch (error) {
                    console.error(`Failed to kill agent ${agentId}:`, error);
                }
            }
            
            agents.clear();
            updateAgentGrid();
            updateMetrics();
        }
        
        // Export session
        async function exportSession() {
            const sessionData = {
                startTime: sessionStartTime,
                duration: Date.now() - sessionStartTime,
                agents: Array.from(agents.values()),
                totalCommands: totalCommands,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(sessionData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `conductor-max-session-${Date.now()}.json`;
            a.click();
        }
        
        // Update metrics
        function updateMetrics() {
            document.getElementById('agent-count').textContent = agents.size;
            document.getElementById('total-commands').textContent = totalCommands;
        }
        
        // Update session duration
        setInterval(() => {
            const duration = Date.now() - sessionStartTime;
            const hours = Math.floor(duration / 3600000);
            const minutes = Math.floor((duration % 3600000) / 60000);
            const seconds = Math.floor((duration % 60000) / 1000);
            document.getElementById('session-duration').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }, 1000);
        
        // Initialize
        updateAgentGrid();
        updateMetrics();
    </script>
</body>
</html>